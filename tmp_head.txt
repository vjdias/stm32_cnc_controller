#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""CLI avanÃ§ada para configurar o TMC5160 (ajuste validado por datasheet).

Permite ajustar mÃºltiplos parÃ¢metros de forma unitÃ¡ria ou combinada, com
validaÃ§Ã£o de faixas e checagem de seguranÃ§a de corrente (I_rms <= 2 A por padrÃ£o).

Uso rÃ¡pido:
  - Ajustar MRES=1/256 e TOFF=3, preservando demais campos:
      python3 -m raspberry_spi.tmc5160_cli set --bus 0 --dev 3 \
          --microsteps 256 --toff 3

  - Limitar corrente: GLOBALSCALER=32, IRUN=8, IHOLD=2, TPOWERDOWN=0x14:
      python3 -m raspberry_spi.tmc5160_cli set --bus 0 --dev 3 \
          --globalscaler 32 --irun 8 --ihold 2 --ihold-delay 6 --tpowerdown 0x14

  - Status resumido (legÃ­vel):
      python3 -m raspberry_spi.tmc5160_cli status --bus 0 --dev 3
"""
from __future__ import annotations

import argparse
import math
from typing import Iterable, List, Optional, Sequence, Tuple

try:
    import sys
    sys.stdout.reconfigure(encoding="utf-8")  # type: ignore[attr-defined]
    sys.stderr.reconfigure(encoding="utf-8")  # type: ignore[attr-defined]
except Exception:
    pass

try:
    from .tmc5160 import (
        REG_GCONF,
        REG_GSTAT,
        REG_GLOBAL_SCALER,
        REG_IHOLD_IRUN,
        REG_TPOWERDOWN,
        REG_TPWMTHRS,
